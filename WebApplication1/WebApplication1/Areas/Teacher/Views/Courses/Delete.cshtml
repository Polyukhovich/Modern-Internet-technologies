@model WebApplication1Data.models.Course

@{
    ViewData["Title"] = "Видалення курсу";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/css/site.css" />

<div class="container">
    <h1 class="title">🗑️ Видалення курсу</h1>

    <!-- Діагностична інформація -->
    <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
        <strong>Діагностика:</strong><br>
        ID курсу: @Model.Id<br>
        Назва: @Model.Title<br>
        Form Action: /Teacher/Courses/DeleteConfirmed
    </div>

    @if (ViewBag.HasRelatedData == true)
    {
        <div class="alert alert-warning" style="background-color: #fff3cd; color: #856404; padding: 12px; border-radius: 5px; margin-bottom: 15px;">
            ⚠️ <strong>Увага!</strong> Цей курс має пов'язані дані (оцінки, матеріали або заняття). При видаленні курсу вони також будуть видалені.
        </div>
    }

    <div class="entity-card">
        <div class="entity-name" style="color: #dc3545;">⚠️ Ви впевнені, що хочете видалити цей курс?</div>

        <div style="margin: 1rem 0;">
            <dl class="row" style="margin-left: 1rem;">
                <dt class="col-sm-3" style="font-weight: 500;">ID курсу:</dt>
                <dd class="col-sm-9">@Model.Id</dd>

                <dt class="col-sm-3" style="font-weight: 500;">Назва курсу:</dt>
                <dd class="col-sm-9">@Html.DisplayFor(model => model.Title)</dd>

                <dt class="col-sm-3" style="font-weight: 500;">Опис:</dt>
                <dd class="col-sm-9">
                    @if (!string.IsNullOrEmpty(Model.Description))
                    {
                        @Model.Description
                    }
                    else
                    {
                        <span style="color: #777; font-style: italic;">Опис відсутній</span>
                    }
                </dd>

                <dt class="col-sm-3" style="font-weight: 500;">Група:</dt>
                <dd class="col-sm-9">
                    @if (!string.IsNullOrEmpty(Model.GroupName))
                    {
                        @Model.GroupName
                    }
                    else
                    {
                        <span style="color: #777; font-style: italic;">Не вказано</span>
                    }
                </dd>
            </dl>
        </div>

        <!-- ВАЖЛИВО: Використовуємо asp-route-id замість прихованого поля -->
        <form asp-area="Teacher" asp-controller="Courses" asp-action="DeleteConfirmed" asp-route-id="@Model.Id" method="post" style="margin-top: 1rem;">
            @Html.AntiForgeryToken()

            <!-- АЛЬТЕРНАТИВА: Якщо вище не працює, спробуйте це -->
            <input type="hidden" name="id" value="@Model.Id" />

            <div style="display: flex; gap: 0.5rem;">
                <button type="submit" class="analyze-btn"
                        style="background-color: #DC3545; flex-grow: 1; text-align: center;"
                        onclick="return confirm('Ви дійсно хочете видалити курс \" @Model.Title\"? Цю дію неможливо скасувати.')">
                    🗑️ Так, видалити курс
                </button>

                <a href="/Teacher/Courses" class="analyze-btn"
                   style="flex-grow: 1; text-align: center; background-color: var(--secondary);">
                    ← Скасувати та повернутися
                </a>
            </div>
        </form>

        <!-- Тестова форма для діагностики -->
        <div style="background: #e7f3ff; padding: 10px; margin-top: 15px; border-radius: 5px;">
            <div style="font-weight: bold; margin-bottom: 5px; color: #0056b3;">Тестові форми:</div>

            <!-- Форма 1: З asp-route-id -->
            <form action="/Teacher/Courses/DeleteConfirmed/@Model.Id" method="post" style="margin-bottom: 5px;">
                @Html.AntiForgeryToken()
                <button type="submit" style="padding: 5px 10px; background: #28a745; color: white; border: none; border-radius: 3px;">
                    Тест 1: URL з ID (@Model.Id)
                </button>
            </form>

            <!-- Форма 2: З параметром в action -->
            <form action="/Teacher/Courses/DeleteConfirmed?id=@Model.Id" method="post" style="margin-bottom: 5px;">
                @Html.AntiForgeryToken()
                <button type="submit" style="padding: 5px 10px; background: #17a2b8; color: white; border: none; border-radius: 3px;">
                    Тест 2: Параметр id=@Model.Id
                </button>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        console.log("=== Delete Page Diagnostics ===");
        console.log("Course ID:", @Model.Id);
        console.log("Course Title:", "@Model.Title");

        // Додаємо обробник для форми
        document.querySelector('form').addEventListener('submit', function(e) {
            console.log("Form submitted");
            console.log("Form action:", this.action);

            // Перевіряємо приховане поле
            const hiddenId = document.querySelector('input[name="id"]');
            if (hiddenId) {
                console.log("Hidden field value:", hiddenId.value);
            }
        });
    </script>
}